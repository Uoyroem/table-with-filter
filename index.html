<style>
    #my-table {
        width: 100%;
        border-collapse: collapse;

    }

    #my-table :where(th, td) {
        border: 1px solid black;
    }
</style>
<div id="filter-menu" style="display: none; background-color: white;">
    <input id="unique-value-search-input" type="text">
    <button id="unique-value-select-all">Выбрать всё</button>
    <button id="unique-value-reset">Сбросить</button>
    <ul id="filter-menu-unique-values" style="overflow-y: scroll; max-height: 10em;">
        
    </ul>
    <button type="button" data-smt-filter-menu-cancel-button>Close</button>
    <button type="button" data-smt-filter-menu-submit-button>OK</button>
</div>
<table 
    id="my-table" 
    data-smt-unique-value-checkbox-target=".unique-value-checkbox" 
    data-smt-unique-value-empty-checkbox-target="#unique-value-empty-checkbox"
    data-smt-unique-value-search-input-target="#unique-value-search-input"
    data-smt-unique-value-list-target="#filter-menu-unique-values"
    data-smt-unique-value-select-all-button-target="#unique-value-select-all"
    data-smt-unique-value-reset-button-target="#unique-value-reset"
    data-smt-unique-value-template='<li data-smt-unique-search-value="{%unique-value%}"><input value="{%unique-value%}" type="checkbox" class="unique-value-checkbox">{%unique-value%}</li>'
    data-smt-unique-values-not-found-template='<li>Здесь ничего нет</li>'
    data-smt-unique-value-empty-template='<li data-smt-unique-value-empty><input type="checkbox" data-smt-unique-value-empty value="" id="unique-value-empty-checkbox">(Пустые)</li>'
    data-smt-unique-values-loading-template='<li>Загрузка...</li>'
    data-smt-filter-menu-target="#filter-menu" 
    data-smt-get-rows-function="getRows" 
    data-smt-get-unique-values-function="getUniqueValues"
>
    <thead>
        <tr>
            <th scope="col">
                ДО
                <button data-smt-filter-menu-open-button data-smt-field="number">
                    =
                </button>
            </th>
            <th scope="col">
                Дата
                <button data-smt-filter-menu-open-button data-smt-field="date">
                    =
                </button>
            </th>
            <th scope="col">
                Утвердитель
                <button data-smt-filter-menu-open-button data-smt-field="approver">
                    =
                </button>
            </th>
            <th scope="col">
                Комментарий
                <button data-smt-filter-menu-open-button data-smt-field="comment">
                    =
                </button>
            </th>
            <th scope="col">5</th>
        </tr>
    </thead>
    <tbody id="tbody-rows"></tbody>
</table>

<script src="table-with-filter.js"></script>
<script>
class MyTableWithFilter extends TableWithFilter {
    async getRows() {
        const response = await fetch("http://127.0.0.1:8000/p1/finance-module/api-get-model-rows", {
            method: "POST",
            body: JSON.stringify({ fieldUniqueValues: this.fieldUniqueValues, model: "UnpaidInvoice" })
        });
        const json = await response.json();
        return json.rows;
    }

    async getUniqueValues() {
        const response = await fetch("http://127.0.0.1:8000/p1/finance-module/api-get-model-unique-values", {
            method: "POST",
            body: JSON.stringify({ field: this.field, fieldUniqueValues: this.fieldUniqueValues, model: "UnpaidInvoice" })
        });
        const json = await response.json();
        return json.uniqueValues;
    }

    showUniqueValues() {
        const filterMenuUniqueValues = document.getElementById("filter-menu-unique-values");
        filterMenuUniqueValues.innerHTML = "";
        for (const uniqueValue of this.uniqueValues) {
            const li = document.createElement("li");
            li.setAttribute("data-smt-unique-search-value", uniqueValue.toString());
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = uniqueValue;
            checkbox.classList.add("unique-value-checkbox")
            li.append(checkbox);
            li.append(uniqueValue.toString());
            filterMenuUniqueValues.append(li);
        }
    }

    clearRows() {
        const tbodyRows = document.getElementById("tbody-rows");
        tbodyRows.innerHTML = "";
    }

    showRows() {
        const tbodyRows = document.getElementById("tbody-rows");
        tbodyRows.innerHTML = "";
        for (const row of this.rows) {
            const tr = document.createElement("tr");
            let td = document.createElement("td");
            td.textContent = row.number;
            tr.append(td)
            td = document.createElement("td");
            td.textContent = row.date;
            tr.append(td)
            td = document.createElement("td");
            td.textContent = row.approver;
            tr.append(td)
            td = document.createElement("td");
            td.textContent = row.comment;
            tr.append(td)   
            tbodyRows.append(tr);
        }
    }
}


let tableWithFilter = null;

document.addEventListener("DOMContentLoaded", function () {
    tableWithFilter = new MyTableWithFilter("#my-table");
});
</script>